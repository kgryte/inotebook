/**
*
*	CONFIG
*
*
*	DESCRIPTION:
*		- Determines the run-time application environment and loads the appropriate configuration file. Default environment is `dev`.
*
*
*	NOTES:
*		[1]
*
*
*	TODO:
*		[1]
*
*
*	LICENSE:
*		MIT
*
*	Copyright (c) 2015. Athan Reines.
*
*
*	AUTHOR:
*		Athan Reines. kgryte@gmail.com. 2015.
*
*/

'use strict';

// MODULES //

var fs = require( 'fs' ),
	path = require( 'path' ),
	pkginfo = require( 'pkginfo' );


// VARIABLES //

var RUNNERS = require( './runners.json' ),
	DEFAULT = 'dev';


// FUNCTIONS //

/**
* FUNCTION: getRoot()
*	Determines the root directory from which the application is run.
*
* @private
*/
function getRoot() {
	var caller,
		i;

	caller = require.main.filename.split( '/' );
	caller = caller[ caller.length-1 ];

	for ( i = 0; i < RUNNERS.length; i++ ) {
		if ( RUNNERS[ i ] === caller ) {
			return process.cwd();
		}
	}
	return path.dirname( pkginfo.find( require.main ) );
} // end FUNCTION getRoot()


// CONFIG //

/**
* FUNCTION: config()
*	Loads a configuration file based on the current Node environment. If the environment is not specified at run time, uses the default environment configuration.
*
* @returns {Object} config object
*/
function config() {
	var env = process.env.NODE_ENV || DEFAULT,
		root = getRoot(),
		filepath;

	filepath = path.join( root, 'etc/'+env+'.json' );

	if ( !fs.existsSync( filepath ) ) {
		filepath = path.join( root, 'etc/'+DEFAULT+'.json' );
	}
	return require( filepath );
} // end FUNCTION config()


// EXPORTS //

module.exports = config(); // singleton
